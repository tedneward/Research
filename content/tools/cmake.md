title=CMake
tags=tool, native, build
summary=Cross-platform build tool.
~~~~~~

CMake is an open-source, cross-platform family of tools designed to build, test and package software. CMake is used to control the software compilation process using simple platform and compiler independent configuration files, and generate native makefiles and workspaces that can be used in the compiler environment of your choice.

[Website](https://cmake.org/) | [Github](https://gitlab.kitware.com/cmake/cmake)

### Reading

* [An Introduction to Modern CMake](https://cliutils.gitlab.io/modern-cmake/) - Henry Schreiner (HTML)
* [CMake Tutorial](https://cmake.org/cmake/help/latest/guide/tutorial/index.html) (HTML)
* [Quick CMake tutorial](https://www.jetbrains.com/help/clion/quick-cmake-tutorial.html) (HTML)

## [Learn X in Y Minutes](https://learnxinyminutes.com/docs/cmake/)
CMake is a cross-platform, open-source build system. This tool allows you to test, compile, and create packages of your source code.

The problem that CMake tries to solve is the problem of Makefiles and Autoconfigure on cross-platforms (different make interpreters have different commands) and the ease-of-use on linking 3rd party libraries.

CMake is an extensible, open-source system that manages the build process in an operating system and compiler-agnostic manner. Unlike many cross-platform systems, CMake is designed to be used in conjunction with the native build environment. Simple configuration files placed in each source directory (called CMakeLists.txt files) are used to generate standard build files (e.g., makefiles on Unix and projects/workspaces in Windows MSVC) which are used in the usual way.

```cmake
# In CMake, this is a comment

# To run our code, please perform the following commands:
#  - mkdir build && cd build
#  - cmake ..
#  - make
# 
# With those steps, we will follow the best practice to compile into a subdir
# and the second line will request to CMake to generate a new OS-dependent
# Makefile. Finally, run the native Make command.

#------------------------------------------------------------------------------
# Basic
#------------------------------------------------------------------------------
#
# The CMake file MUST be named as "CMakeLists.txt".

# Setup the minimum version required of CMake to generate the Makefile
cmake_minimum_required (VERSION 2.8)

# Raises a FATAL_ERROR if version < 2.8
cmake_minimum_required (VERSION 2.8 FATAL_ERROR)

# We define the name of our project, and this changes some directories
# naming convention generated by CMake. We can send the LANG of code
# as the second param
project (learncmake C)

# Set the project source dir (just convention)
set( LEARN_CMAKE_SOURCE_DIR ${CMAKE_CURRENT_SOURCE_DIR} )
set( LEARN_CMAKE_BINARY_DIR ${CMAKE_CURRENT_BINARY_DIR} )

# It's useful to set up the current version of our code in the build system
# using a `semver` style
set (LEARN_CMAKE_VERSION_MAJOR 1)
set (LEARN_CMAKE_VERSION_MINOR 0)
set (LEARN_CMAKE_VERSION_PATCH 0)

# Send the variables (version number) to the source code header
configure_file (
  "${PROJECT_SOURCE_DIR}/TutorialConfig.h.in"
  "${PROJECT_BINARY_DIR}/TutorialConfig.h"
)

# Include Directories
# In GCC, this will invoke the "-I" command
include_directories( include )

# Where are the additional libraries installed? Note: provide includes
# path here, subsequent checks will resolve everything else
set( CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${CMAKE_SOURCE_DIR}/CMake/modules/" )

# Conditions
if ( CONDITION )
  # Output!

  # Incidental information
  message(STATUS "My message")

  # CMake Warning, continue processing
  message(WARNING "My message")

  # CMake Warning (dev), continue processing
  message(AUTHOR_WARNING "My message")

  # CMake Error, continue processing, but skip generation
  message(SEND_ERROR "My message")

  # CMake Error, stop processing and generation
  message(FATAL_ERROR "My message")
endif()

if( CONDITION )

elseif( CONDITION )

else( CONDITION )

endif( CONDITION )

# Loops
foreach(loop_var arg1 arg2 ...)
  COMMAND1(ARGS ...)
  COMMAND2(ARGS ...)
  ...
endforeach(loop_var)

foreach(loop_var RANGE total)
foreach(loop_var RANGE start stop [step])

foreach(loop_var IN [LISTS [list1 [...]]]
                    [ITEMS [item1 [...]]])

while(condition)
  COMMAND1(ARGS ...)
  COMMAND2(ARGS ...)
  ...
endwhile(condition)


# Logic Operations
if(FALSE AND (FALSE OR TRUE))
  message("Don't display!")
endif()

# Set a regular, cache, or environment variable to a given value.
# If the PARENT_SCOPE option is given, the variable will be set in the scope
# above the current scope.
# `set(<variable> <value>... [PARENT_SCOPE])`

# How to reference variables inside quoted and unquoted arguments?
# A variable reference is replaced by either the variable value or by the 
# empty string if the variable is not set.
${variable_name}

# Lists
# Setup the list of source files
set( LEARN_CMAKE_SOURCES 
  src/main.c
  src/imagem.c
  src/pather.c
)

# Calls the compiler
#
# ${PROJECT_NAME} refers to Learn_CMake 
add_executable( ${PROJECT_NAME} ${LEARN_CMAKE_SOURCES} )

# Link the libraries
target_link_libraries( ${PROJECT_NAME} ${LIBS} m )

# Where are the additional libraries installed? Note: provide includes
# path here, subsequent checks will resolve everything else
set( CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${CMAKE_SOURCE_DIR}/CMake/modules/" )

# Compiler Condition (gcc ; g++)
if ( "${CMAKE_C_COMPILER_ID}" STREQUAL "GNU" )
  message( STATUS "Setting the flags for ${CMAKE_C_COMPILER_ID} compiler" )
  add_definitions( --std=c99 )
endif()

# Check for OS
if( UNIX )
    set( LEARN_CMAKE_DEFINITIONS
        "${LEARN_CMAKE_DEFINITIONS} -Wall -Wextra -Werror -Wno-deprecated-declarations -Wno-unused-parameter -Wno-comment" )
endif()
```

### More Resources

+ [CMake tutorial](https://cmake.org/cmake-tutorial/)
+ [CMake documentation](https://cmake.org/documentation/)
+ [Mastering CMake](http://amzn.com/1930934319/)
+ [An Introduction to Modern CMake](https://cliutils.gitlab.io/modern-cmake/)

---

## Links
[Awesome CMake](https://github.com/onqtam/awesome-cmake): A curated list of awesome CMake scripts, modules, examples and others


## Examples
- C++/CMake modern boilerplate
	- https://github.com/Lectem/cpp-boilerplate
- CMake: config mode of find_package command (examples)
	- https://github.com/forexample/package-example
- CMake cookbook recipes
	- https://github.com/dev-cafe/cmake-cookbook
- CMake Examples
	- https://github.com/ttroy50/cmake-examples
- learning-cmake: a simple CMake tutorial project which contains some different scenarios
	- https://github.com/Akagi201/learning-cmake
- Modern CMake Examples
	- https://github.com/pr0g/cmake-examples
- Polly: Collection of CMake toolchain files and scripts for cross-platform build and CI testing (GCC, Visual Studio, iOS, Android, Clang analyzer, sanitizers etc.) 
	- https://github.com/ruslo/polly


## Reading
- Basic CMake usage
	- https://codingnest.com/basic-cmake/
- CGold: The Hitchhiker’s Guide to the CMake
	- https://cgold.readthedocs.io/en/latest/
- CMake 3.16 added support for precompiled headers & unity builds - what you need to know
	- http://onqtam.com/programming/2019-12-20-pch-unity-cmake-3-16/
- CMake Coding Style
	- https://community.kde.org/Policies/CMake_Coding_Style
- Dev Santa Claus - Nick Sarten
	- Part 1: Adding Clang Sanitizers to a CMake Build
		- https://genbattle.bitbucket.io/blog/2018/01/05/Dev-Santa-Claus-Part-1/
	- Part 2: C++ code coverage metrics with gcov
		- setting up code coverage metrics for a C++ codebase built using Bamboo, CMake, and GCC
		- https://genbattle.bitbucket.io/blog/2018/01/19/Dev-Santa-Claus-Part-2/
- Effective CMake by Kai Wolf
	- http://effective-cmake.com
	- https://leanpub.com/effective-cmake
- Effective Modern CMake - Manuel Binna
	- https://gist.github.com/mbinna/c61dbb39bca0e4fb7d1f73b0d66a4fd1
- Everything You Never Wanted to Know About CMake
	- https://izzys.casa/2019/02/everything-you-never-wanted-to-know-about-cmake/
- How to Build a CMake-Based Project
	- http://preshing.com/20170511/how-to-build-a-cmake-based-project/
- It's Time To Do CMake Right
	- https://pabloariasal.github.io/2018/02/19/its-time-to-do-cmake-right/
- Learn CMake's Scripting Language in 15 Minutes
	- http://preshing.com/20170522/learn-cmakes-scripting-language-in-15-minutes/
- Professional CMake: A Practical Guide
	- https://crascit.com/professional-cmake/
- siliceum - Clément Grégoire
	- CMake basics
		- https://www.siliceum.com/en/blog/post/cmake_01_cmake-basics
	- CMake customization points
		- https://www.siliceum.com/en/blog/post/cmake_02_customization-points
- Speed up your C++ unit tests cycles with CMake/CTest (and the right testing framework)
	- https://a4z.bitbucket.io/blog/2018/05/17/Speed-up-your-test-cycles-with-CMake.html
- The Architecture of Open Source Applications: CMake
	- http://www.aosabook.org/en/cmake.html
- The Ultimate Guide to Modern CMake
	- https://rix0r.nl/blog/2015/08/13/cmake-guide/
- Tutorial: Easy dependency management for C++ with CMake and Git
	- http://foonathan.net/blog/2016/07/07/cmake-dependency-handling.html
- Using ccache with CMake
	- https://crascit.com/2016/04/09/using-ccache-with-cmake/


## Talks
- Building C++
	- C++ Edinburgh 2018; Morris Hafner
	- https://www.youtube.com/watch?v=n_f-2p5eDBo
- C++ Weekly - Jason Turner
	- Ep 78 - Intro to CMake
		- https://www.youtube.com/watch?v=HPMvU64RUTY
		- https://github.com/lefticus/cpp_starter_project
	- Ep 82 - Intro To CTest
		- https://www.youtube.com/watch?v=ZlMbqFcJEzA
	- Ep 208 - The Ultimate CMake / C++ Quick Start
		- "CMake, sanitizers, clang-tidy, conan, cmake-format, clang-format, cppcheck, doxygen, ctest, catch, {fmt}, and more!"
		- https://www.youtube.com/watch?v=YbgH7yat-Jo
- Deep CMake for Library Authors
	- CppCon 2019; Craig Scott
	- https://www.youtube.com/watch?v=m0DwB4OvDXk
- Effective CMake
	- Daniel Pfeifer
	- C++Now 2017
		- https://www.youtube.com/watch?v=bsXLMQ6WgIk
		- https://github.com/boostcon/cppnow_presentations_2017/raw/master/05-19-2017_friday/effective_cmake__daniel_pfeifer__cppnow_05-19-2017.pdf
	- MUCplusplus 2017
		- https://www.youtube.com/watch?v=rLopVhns4Zs
- Effective dependency management with CMake
	- MUCplusplus 2017; Kai Wolf 
	- https://www.youtube.com/watch?v=QayyhI-36os
- Embracing Modern CMake
	- Stephen Kelly
	- https://steveire.wordpress.com/2017/11/05/embracing-modern-cmake/
	- Dublin C++ User Group 2017
		- https://www.youtube.com/watch?v=JsjI5xr1jxM
	- NDC TechTown 2019
		- https://www.youtube.com/watch?v=mn1ZnO3MtVk
- How to CMake Good
	- https://vector-of-bool.github.io/2018/08/12/cmake-good.html
	- https://www.youtube.com/playlist?list=PLK6MXr8gasrGmIiSuVQXpfFuE1uPT615s
- Introduction to CMake
	- SwedenCpp 2018; Florent Castelli
	- Examples:
		- https://bit.ly/swedencpp-cmake-workshop
		- https://github.com/Orphis/cmake-workshop
	- Slides:
		- https://bit.ly/swedencpp-cmake-slides
		- https://docs.google.com/presentation/d/1vIEfCE33-1BEMT1nNQQbhe-1va-3m2pL9c6_WrIIjdU/
	- Video:
		- https://www.youtube.com/watch?v=jt3meXdP-QI
- Modern CMake for modular design
	- Meeting C++ 2017; Mathieu Ropert
	- https://www.youtube.com/watch?v=ztrnb-bVVPo
- More Modern CMake - Working with CMake 3.12 and later
	- Meeting C++ 2018; Deniz Bahadir
	- https://meetingcpp.com/2018/Talks/items/More_Modern_CMake___Working_with_CMake_3_12_and_later.html
	- https://meetingcpp.com/mcpp/slides/2018/MoreModernCMake.pdf
	- https://www.youtube.com/watch?v=y7ndUhdQuU8
- Oh No! More Modern CMake
	- Meeting C++ 2019; Deniz Bahadir
	- https://www.youtube.com/watch?v=y9kSr5enrSk
	- https://github.com/Bagira80/More-Modern-CMake
- Using Modern CMake Patterns to Enforce a Good Modular Design
	- CppCon 2017; Mathieu Ropert 
	- https://www.youtube.com/watch?v=eC9-iRN2b04


## Additional software
- BLT (Build, Link and Triumph): A streamlined CMake build system foundation for developing HPC software
	- composition of CMake macros and several widely used open source tools assembled to simplify HPC software development.
	- https://github.com/llnl/blt
	- http://llnl-blt.readthedocs.io/en/latest/
- CMake Unit
	- A unit testing framework for CMake.
	- https://github.com/polysquare/cmake-unit
- CMakeBuildPackage: Automatic project build script with CMake
	- https://github.com/berenm/CMakeBuildPackage
- cmake format: Source code formatter for cmake listfiles.
	- https://github.com/cheshirekow/cmake_format
- CMake Modules
	- Additional CMake Modules
		- https://github.com/bilke/cmake-modules
	- Ryan's CMake Modules
		- https://github.com/rpavlik/cmake-modules
- cmany: CMake build tree batching tool
	- https://github.com/biojppm/cmany
- configure-cmake: autotools-style configure script wrapper around CMake
	- https://github.com/nemequ/configure-cmake
- CPM.cmake
	- CMake's missing package manager. A small CMake script for setup-free, cross-platform and reproducible dependency management.
	- https://github.com/TheLartians/CPM.cmake
- Izzy's eXtension Modules: Make CMake less painful when trying to write Modern Flexible CMake
	- https://github.com/slurps-mad-rips/ixm
- ucm - useful cmake macros
	- https://github.com/onqtam/ucm
